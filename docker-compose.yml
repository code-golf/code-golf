version: '2'
services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    command:
      - reflex
      - -sd
      - none
      - -r
      - \.(go|html|pem|svg|toml)$$
      - -R
      - ^\.go/|_test\.go$$
      - --
      - go
      - run
      - -tags
      - dev
      - .
    environment:
      DEV:       1
      PGHOST:    db
      PGSSLMODE: disable
      PGUSER:    code_golf
    ports:
      - 80:80
      - 443:443
    privileged: true
    volumes:
      - .:/go
  db:
    image: postgres:12.1-alpine
    environment:
      POSTGRES_DB: code_golf
    volumes:
      - ./db:/docker-entrypoint-initdb.d
