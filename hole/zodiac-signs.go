package hole

import (
	"fmt"
	"math/rand"
)

var sunSigns = [...]sunSign{
	{3, 21, 31, "♈", []string{"♒", "♒", "♓", "♓", "♈", "♈", "♉", "♉", "♊", "♊", "♋", "♋", "♌", "♌", "♍", "♍", "♎", "♎", "♏", "♏", "♐", "♐", "♑", "♑"}},
	{4, 1, 19, "♈", []string{"♒", "♒", "♓", "♓", "♈", "♈", "♉", "♉", "♊", "♊", "♋", "♋", "♌", "♌", "♍", "♍", "♎", "♎", "♏", "♏", "♐", "♐", "♑", "♑"}},
	{4, 20, 30, "♉", []string{"♓", "♓", "♈", "♈", "♉", "♉", "♊", "♊", "♋", "♋", "♌", "♌", "♍", "♍", "♎", "♎", "♏", "♏", "♐", "♐", "♑", "♑", "♒", "♒"}},
	{5, 1, 20, "♉", []string{"♓", "♓", "♈", "♈", "♉", "♉", "♊", "♊", "♋", "♋", "♌", "♌", "♍", "♍", "♎", "♎", "♏", "♏", "♐", "♐", "♑", "♑", "♒", "♒"}},
	{5, 21, 31, "♊", []string{"♈", "♈", "♉", "♉", "♊", "♊", "♋", "♋", "♌", "♌", "♍", "♍", "♎", "♎", "♏", "♏", "♐", "♐", "♑", "♑", "♒", "♒", "♓", "♓"}},
	{6, 1, 21, "♊", []string{"♈", "♈", "♉", "♉", "♊", "♊", "♋", "♋", "♌", "♌", "♍", "♍", "♎", "♎", "♏", "♏", "♐", "♐", "♑", "♑", "♒", "♒", "♓", "♓"}},
	{6, 22, 30, "♋", []string{"♉", "♉", "♊", "♊", "♋", "♋", "♌", "♌", "♍", "♍", "♎", "♎", "♏", "♏", "♐", "♐", "♑", "♑", "♒", "♒", "♓", "♓", "♈", "♈"}},
	{7, 1, 22, "♋", []string{"♉", "♉", "♊", "♊", "♋", "♋", "♌", "♌", "♍", "♍", "♎", "♎", "♏", "♏", "♐", "♐", "♑", "♑", "♒", "♒", "♓", "♓", "♈", "♈"}},
	{7, 23, 31, "♌", []string{"♊", "♊", "♋", "♋", "♌", "♌", "♍", "♍", "♎", "♎", "♏", "♏", "♐", "♐", "♑", "♑", "♒", "♒", "♓", "♓", "♈", "♈", "♉", "♉"}},
	{8, 1, 22, "♌", []string{"♊", "♊", "♋", "♋", "♌", "♌", "♍", "♍", "♎", "♎", "♏", "♏", "♐", "♐", "♑", "♑", "♒", "♒", "♓", "♓", "♈", "♈", "♉", "♉"}},
	{8, 23, 31, "♍", []string{"♋", "♋", "♌", "♌", "♍", "♍", "♎", "♎", "♏", "♏", "♐", "♐", "♑", "♑", "♒", "♒", "♓", "♓", "♈", "♈", "♉", "♉", "♊", "♊"}},
	{9, 1, 22, "♍", []string{"♋", "♋", "♌", "♌", "♍", "♍", "♎", "♎", "♏", "♏", "♐", "♐", "♑", "♑", "♒", "♒", "♓", "♓", "♈", "♈", "♉", "♉", "♊", "♊"}},
	{9, 23, 30, "♎", []string{"♌", "♌", "♍", "♍", "♎", "♎", "♏", "♏", "♐", "♐", "♑", "♑", "♒", "♒", "♓", "♓", "♈", "♈", "♉", "♉", "♊", "♊", "♋", "♋"}},
	{10, 1, 22, "♎", []string{"♌", "♌", "♍", "♍", "♎", "♎", "♏", "♏", "♐", "♐", "♑", "♑", "♒", "♒", "♓", "♓", "♈", "♈", "♉", "♉", "♊", "♊", "♋", "♋"}},
	{10, 23, 31, "♏", []string{"♍", "♍", "♎", "♎", "♏", "♏", "♐", "♐", "♑", "♑", "♒", "♒", "♓", "♓", "♈", "♈", "♉", "♉", "♊", "♊", "♋", "♋", "♌", "♌"}},
	{11, 1, 22, "♏", []string{"♍", "♍", "♎", "♎", "♏", "♏", "♐", "♐", "♑", "♑", "♒", "♒", "♓", "♓", "♈", "♈", "♉", "♉", "♊", "♊", "♋", "♋", "♌", "♌"}},
	{11, 23, 30, "♐", []string{"♎", "♎", "♏", "♏", "♐", "♐", "♑", "♑", "♒", "♒", "♓", "♓", "♈", "♈", "♉", "♉", "♊", "♊", "♋", "♋", "♌", "♌", "♍", "♍"}},
	{12, 1, 21, "♐", []string{"♎", "♎", "♏", "♏", "♐", "♐", "♑", "♑", "♒", "♒", "♓", "♓", "♈", "♈", "♉", "♉", "♊", "♊", "♋", "♋", "♌", "♌", "♍", "♍"}},
	{12, 22, 31, "♑", []string{"♏", "♏", "♐", "♐", "♑", "♑", "♒", "♒", "♓", "♓", "♈", "♈", "♉", "♉", "♊", "♊", "♋", "♋", "♌", "♌", "♍", "♍", "♎", "♎"}},
	{1, 1, 19, "♑", []string{"♏", "♏", "♐", "♐", "♑", "♑", "♒", "♒", "♓", "♓", "♈", "♈", "♉", "♉", "♊", "♊", "♋", "♋", "♌", "♌", "♍", "♍", "♎", "♎"}},
	{1, 20, 31, "♒", []string{"♐", "♐", "♑", "♑", "♒", "♒", "♓", "♓", "♈", "♈", "♉", "♉", "♊", "♊", "♋", "♋", "♌", "♌", "♍", "♍", "♎", "♎", "♏", "♏"}},
	{2, 1, 18, "♒", []string{"♐", "♐", "♑", "♑", "♒", "♒", "♓", "♓", "♈", "♈", "♉", "♉", "♊", "♊", "♋", "♋", "♌", "♌", "♍", "♍", "♎", "♎", "♏", "♏"}},
	{2, 19, 28, "♓", []string{"♑", "♑", "♒", "♒", "♓", "♓", "♈", "♈", "♉", "♉", "♊", "♊", "♋", "♋", "♌", "♌", "♍", "♍", "♎", "♎", "♏", "♏", "♐", "♐"}},
	{3, 1, 20, "♓", []string{"♑", "♑", "♒", "♒", "♓", "♓", "♈", "♈", "♉", "♉", "♊", "♊", "♋", "♋", "♌", "♌", "♍", "♍", "♎", "♎", "♏", "♏", "♐", "♐"}},
}

type sunSign struct {
	month, startDate, endDate int
	symbol                    string
	risingSymbols             []string
}

func symbolsToString(sunSymbol string, risingSymbol string) string {
	if sunSymbol == risingSymbol {
		return sunSymbol
	}
	return fmt.Sprintf("%s%s", sunSymbol, risingSymbol)
}

func (sign sunSign) randomDate(hour int) test {
	day := randInt(sign.startDate, sign.endDate)
	return sign.test(day, hour)
}

func (sign sunSign) edgeDate(hour int) test {
	day := sign.startDate
	if day == 1 {
		day = sign.endDate
	}
	return sign.test(day, hour)
}

func (sign sunSign) test(day int, hour int) test {
	minute := rand.Intn(60)
	return test{fmt.Sprintf("%02d-%02d %02d:%02d", sign.month, day, hour, minute), symbolsToString(sign.symbol, sign.risingSymbols[hour])}
}

func zodiacSigns() ([]string, string) {
	const (
		randomCases = 20
		hours       = 24
		totalCases  = randomCases + len(sunSigns) + len(sunSigns)*hours
	)

	tests := make([]test, randomCases, totalCases)

	for i := 0; i < randomCases; i++ {
		tests[i] = randChoice(sunSigns[:]).randomDate(rand.Intn(hours))
	}

	for _, sunSign := range sunSigns {
		tests = append(tests, sunSign.edgeDate(rand.Intn(hours)))
		for hour := 0; hour < hours; hour++ {
			tests = append(tests, sunSign.randomDate(hour))
		}
	}

	return outputTests(shuffle(tests))
}
